<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="oil.js Sandbox">

  <link rel="icon" href="/favicon.ico">

  <title>oil.js sandbox</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="assets/dashboard.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@vladocar/nanojs/src/nanoJS.min.js"></script>
  <script id="oil-configuration" type="application/configuration">
      {
        "advanced_settings": true,
        "timeout": -1
      }

  </script>
</head>

<body>
<nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/index.html">oil.js sandbox</a>
</nav>


<!--ToDo: https://feathericons.com/-->
<div class="container-fluid">
  <div class="row">
    <nav class="col-md-2 d-none d-md-block bg-light sidebar">
      <div class="sidebar-sticky">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="#">
              <span data-feather="home"></span>
              Main
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="settings"></span>
              OIL Configuration
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="sliders"></span>
              Cookie Preference Center (CPC)
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="book"></span>
              Documentation
            </a>
          </li>
        </ul>

        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
          <span>CMP API Calls</span>
        </h6>
        <ul class="nav flex-column mb-2">
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="code"></span>
              getVendorConsents()
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="code"></span>
              getConsentData()
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="code"></span>
              ping()
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="code"></span>
              getPublisherConsents()
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="code"></span>
              getVendorList()
            </a>
          </li>
        </ul>
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
          <span>Tag Soft Blocking</span>
        </h6>
        <ul class="nav flex-column mb-2">
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="tag"></span>
              script-Tag
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="image"></span>
              img-Tag
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!--main section-->
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
      <h1>oil.js ping</h1>
    </main>
  </div>
</div>

<!-- Icons -->
<script type="text/javascript" src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script type="text/javascript">feather.replace();</script>
<!--SDK -->
<script type="text/javascript">
  function eventDataContains(event, eventNames) {
    return eventNames.filter((name) => JSON.stringify(event.data).indexOf(name) !== -1).length > 0;
  }

  function printCookieData() {
    if (AS_OIL.status().opt_in) {
      document.getElementById('oilCookieOptIn').innerHTML = AS_OIL.status().opt_in;
      document.getElementById('oilCookieOilVersion').innerHTML = AS_OIL.status().version;
      document.getElementById('oilCookieLocaleVariantName').innerHTML = AS_OIL.status().localeVariantName;
      document.getElementById('oilCookieLocaleVariantVersion').innerHTML = AS_OIL.status().localeVariantVersion;
      document.getElementById('oilCookieCustomPurposeIds').innerHTML = AS_OIL.status().customPurposes;
      document.getElementById('oilCookieConsentString').innerHTML = AS_OIL.status().consentString;
    } else {
      document.getElementById('oilCookieOptIn').innerHTML = '';
      document.getElementById('oilCookieOilVersion').innerHTML = '';
      document.getElementById('oilCookieLocaleVariantName').innerHTML = '';
      document.getElementById('oilCookieLocaleVariantVersion').innerHTML = '';
      document.getElementById('oilCookieCustomPurposeIds').innerHTML = '';
      document.getElementById('oilCookieConsentString').innerHTML = '';

    }
  }

  function receiveOilMessage(event) {
    if (event && event.data && (eventDataContains(event, ['oil_optin_done', 'oil_has_optedin', 'oil_optout_done']))) {
      console.log('receiveOilMessage', event);
      printCookieData();
    }
  }

  function resetOil() {
    AS_OIL.triggerOptOut();
    AS_OIL.reload();
  }

  function configureResetButton() {
    $('#resetButton').on('click', () => resetOil())
  }

  function countDown(startValue) {

    let currentValue = startValue;
    let countdownElement = document.getElementById('simulateBannerTimeoutCountdown');
    let containerElement = document.getElementById('simulateBannerTimeoutContainer');

    countdownElement.innerHTML = currentValue + " seconds";
    containerElement.style.visibility = 'hidden';
    countdownElement.style.visibility = 'visible';

    let x = setInterval(() => {
      if (--currentValue <= 0) {
        clearInterval(x);
        countdownElement.style.visibility = 'hidden';
        countdownElement.innerHTML = '';
        containerElement.style.visibility = 'visible';
        return;
      }
      countdownElement.innerHTML = currentValue + " seconds";
    }, 1000);
  }

  function configureTimeoutSimulator() {

    document.getElementById('simulateBannerTimeoutCountdown').style.visibility = 'hidden';

    $('#simulateBannerTimeoutButton').on('click', () => {
      let config = JSON.parse(document.getElementById('oil-configuration').text);
      let timeoutValue = parseInt(document.getElementById('simulateBannerTimeoutValue').value);

      if (isNaN(timeoutValue) || timeoutValue === 0) return;

      config['timeout'] = timeoutValue;
      document.getElementById('oil-configuration').text = JSON.stringify(config);

      resetOil();
      countDown(timeoutValue);
    });
  }

  let eventMethod = window.addEventListener ? 'addEventListener' : 'attachEvent';
  let messageEvent = eventMethod === 'attachEvent' ? 'onmessage' : 'message';
  let eventer = window[eventMethod];

  eventer(messageEvent, receiveOilMessage, false);

  printCookieData();
  configureResetButton();
  configureTimeoutSimulator();


</script>
</body>
</html>
